(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{138:function(n,e,t){"use strict";t.d(e,"a",(function(){return g})),t.d(e,"b",(function(){return p}));var i=t(0),o=t.n(i);function a(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function l(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,i)}return t}function r(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?l(Object(t),!0).forEach((function(e){a(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}function s(n,e){if(null==n)return{};var t,i,o=function(n,e){if(null==n)return{};var t,i,o={},a=Object.keys(n);for(i=0;i<a.length;i++)t=a[i],e.indexOf(t)>=0||(o[t]=n[t]);return o}(n,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);for(i=0;i<a.length;i++)t=a[i],e.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(n,t)&&(o[t]=n[t])}return o}var c=o.a.createContext({}),d=function(n){var e=o.a.useContext(c),t=e;return n&&(t="function"==typeof n?n(e):r(r({},e),n)),t},g=function(n){var e=d(n.components);return o.a.createElement(c.Provider,{value:e},n.children)},b={inlineCode:"code",wrapper:function(n){var e=n.children;return o.a.createElement(o.a.Fragment,{},e)}},u=o.a.forwardRef((function(n,e){var t=n.components,i=n.mdxType,a=n.originalType,l=n.parentName,c=s(n,["components","mdxType","originalType","parentName"]),g=d(t),u=i,p=g["".concat(l,".").concat(u)]||g[u]||b[u]||a;return t?o.a.createElement(p,r(r({ref:e},c),{},{components:t})):o.a.createElement(p,r({ref:e},c))}));function p(n,e){var t=arguments,i=e&&e.mdxType;if("string"==typeof n||i){var a=t.length,l=new Array(a);l[0]=u;var r={};for(var s in e)hasOwnProperty.call(e,s)&&(r[s]=e[s]);r.originalType=n,r.mdxType="string"==typeof n?n:i,l[1]=r;for(var c=2;c<a;c++)l[c]=t[c];return o.a.createElement.apply(null,l)}return o.a.createElement.apply(null,t)}u.displayName="MDXCreateElement"},215:function(n,e,t){"use strict";t.r(e),e.default=t.p+"assets/images/loading-29d1084ff1729185846f2c27ff7d0e2b.png"},87:function(n,e,t){"use strict";t.r(e),t.d(e,"frontMatter",(function(){return l})),t.d(e,"metadata",(function(){return r})),t.d(e,"toc",(function(){return s})),t.d(e,"default",(function(){return d}));var i=t(3),o=t(7),a=(t(0),t(138)),l={title:"Add Global Singleton Loading for Http Requests",date:"2020-06-09",update:"2020-06-17",template:"post",tags:["FE","Vue","CSS","Design Pattern"]},r={permalink:"/leonaxiongxin.github.io/cn/blog/2020/06/09/add-global-singleton-loading-for-http-requests",source:"@site/blog/2020-06-09-add-global-singleton-loading-for-http-requests.md",description:"\u6211\u6709\u4e00\u4e2a\u7f8e\u4e3d\u7684\u613f\u671b\uff1aDon't repeat yourself.",date:"2020-06-09T00:00:00.000Z",formattedDate:"2020 M06 9",tags:[{label:"FE",permalink:"/leonaxiongxin.github.io/cn/blog/tags/fe"},{label:"Vue",permalink:"/leonaxiongxin.github.io/cn/blog/tags/vue"},{label:"CSS",permalink:"/leonaxiongxin.github.io/cn/blog/tags/css"},{label:"Design Pattern",permalink:"/leonaxiongxin.github.io/cn/blog/tags/design-pattern"}],title:"Add Global Singleton Loading for Http Requests",readingTime:5.805,truncated:!0,prevItem:{title:"Take a Look at React Components",permalink:"/leonaxiongxin.github.io/cn/blog/2020/06/14/Take-a-Look-at-React-Components"},nextItem:{title:"\u524d\u7aef\u9879\u76ee\u811a\u624b\u67b6\u505a\u4e86\u4ec0\u4e48\uff1f",permalink:"/leonaxiongxin.github.io/cn/blog/2020/06/07/What-does-FE-CLI-do"}},s=[{value:"\u9700\u6c42\u80cc\u666f",id:"\u9700\u6c42\u80cc\u666f",children:[{value:"\u4e3a\u4ec0\u4e48\u8981\u6dfb\u52a0\u5168\u5c40 Loading",id:"\u4e3a\u4ec0\u4e48\u8981\u6dfb\u52a0\u5168\u5c40-loading",children:[]},{value:"\u5982\u4f55\u5728\u4e0d\u5f71\u54cd\u9879\u76ee\u5df2\u6709\u4e1a\u52a1\u4ee3\u7801\u7684\u524d\u63d0\u4e0b\u6dfb\u52a0",id:"\u5982\u4f55\u5728\u4e0d\u5f71\u54cd\u9879\u76ee\u5df2\u6709\u4e1a\u52a1\u4ee3\u7801\u7684\u524d\u63d0\u4e0b\u6dfb\u52a0",children:[]},{value:"\u5982\u4f55\u5904\u7406\u4e32\u884c\u3001\u5e76\u884c\u7684\u591a\u4e2a\u8bf7\u6c42",id:"\u5982\u4f55\u5904\u7406\u4e32\u884c\u3001\u5e76\u884c\u7684\u591a\u4e2a\u8bf7\u6c42",children:[]}]},{value:"\u9700\u6c42\u5b9e\u73b0",id:"\u9700\u6c42\u5b9e\u73b0",children:[{value:"\u81ea\u5b9a\u4e49\u7ec4\u4ef6",id:"\u81ea\u5b9a\u4e49\u7ec4\u4ef6",children:[]},{value:"\u5355\u4f8b\u6a21\u5f0f",id:"\u5355\u4f8b\u6a21\u5f0f",children:[]},{value:"Axios \u89e3\u6790",id:"axios-\u89e3\u6790",children:[]}]},{value:"\u6700\u7ec8\u6548\u679c",id:"\u6700\u7ec8\u6548\u679c",children:[]}],c={toc:s};function d(n){var e=n.components,l=Object(o.a)(n,["components"]);return Object(a.b)("wrapper",Object(i.a)({},c,l,{components:e,mdxType:"MDXLayout"}),Object(a.b)("p",null,"\u6211\u6709\u4e00\u4e2a\u7f8e\u4e3d\u7684\u613f\u671b\uff1aDon't repeat yourself."),Object(a.b)("h2",{id:"\u9700\u6c42\u80cc\u666f"},"\u9700\u6c42\u80cc\u666f"),Object(a.b)("h3",{id:"\u4e3a\u4ec0\u4e48\u8981\u6dfb\u52a0\u5168\u5c40-loading"},"\u4e3a\u4ec0\u4e48\u8981\u6dfb\u52a0\u5168\u5c40 Loading"),Object(a.b)("p",null,"\u867d\u7136\u73b0\u6709\u7ec4\u4ef6\u5e93\u63d0\u4f9b\u4e86 Loading \u7684\u5c01\u88c5\u65b9\u6cd5\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u7684\u4ee3\u7801\uff0c\u5728\u8bf7\u6c42\u5f00\u59cb\u524d\u5f00\u542f Loading\uff0c\u8bf7\u6c42\u7ed3\u675f\u540e\u5173\u95edLoading\u3002\u4f46\u662f\u5982\u679c\u5bf9\u5f88\u591a\u4e2a\u8bf7\u6c42\u90fd\u8981\u5199\u7c7b\u4f3c\u8fd9\u6837\u7684\u4ee3\u7801\uff0c\u8fd8\u662f\u7565\u9ebb\u70e6\u3002\u6240\u4ee5\u73b0\u5728\u7684\u9700\u6c42\u662f\u4e3a Http \u8bf7\u6c42\u6dfb\u52a0\u5168\u5c40 Loading\u3002"),Object(a.b)("h3",{id:"\u5982\u4f55\u5728\u4e0d\u5f71\u54cd\u9879\u76ee\u5df2\u6709\u4e1a\u52a1\u4ee3\u7801\u7684\u524d\u63d0\u4e0b\u6dfb\u52a0"},"\u5982\u4f55\u5728\u4e0d\u5f71\u54cd\u9879\u76ee\u5df2\u6709\u4e1a\u52a1\u4ee3\u7801\u7684\u524d\u63d0\u4e0b\u6dfb\u52a0"),Object(a.b)("p",null,"\u5728\u6211\u4eec\u7684\u9879\u76ee\u5df2\u6709\u4e1a\u52a1\u4ee3\u7801\u91cc\uff0c\u5e76\u4e0d\u662f\u6240\u6709\u7684\u8bf7\u6c42\u90fd\u6dfb\u52a0\u4e86 Loading \u6548\u679c\uff0c\u53ea\u662f\u9488\u5bf9\u90e8\u5206\u8017\u65f6\u8f83\u957f\u7684\u8bf7\u6c42\u3002"),Object(a.b)("p",null,"\u4e3a\u4e86\u4e0d\u5f71\u54cd\u5df2\u6709\u4ee3\u7801\uff0c\u4e3a\u5168\u5c40\u7684 Http \u8bf7\u6c42\u65b9\u6cd5\u6dfb\u52a0\u53ef\u914d\u7f6e\u53c2\u6570 showLoader \u6765\u63a7\u5236\u662f\u5426\u6dfb\u52a0 Loading\uff0c\u9ed8\u8ba4\u4e3afalse\u3002"),Object(a.b)("h3",{id:"\u5982\u4f55\u5904\u7406\u4e32\u884c\u3001\u5e76\u884c\u7684\u591a\u4e2a\u8bf7\u6c42"},"\u5982\u4f55\u5904\u7406\u4e32\u884c\u3001\u5e76\u884c\u7684\u591a\u4e2a\u8bf7\u6c42"),Object(a.b)("p",null,"\u4e32\u884c\u7684\u591a\u4e2a\u8bf7\u6c42\uff0c\u53ef\u4ee5\u6309\u8bf7\u6c42\u987a\u5e8f\u5c55\u793a\u3001\u5173\u95ed Loading\uff0c\u4f46\u662f\u5728\u8bf7\u6c42\u95f4\u9694\u65f6\u95f4\u5f88\u77ed\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u80fd\u6709\u635f\u7528\u6237\u4f53\u9a8c\u3002"),Object(a.b)("p",null,"\u5e76\u884c\u7684\u591a\u4e2a\u8bf7\u6c42\uff0c\u5982\u679c\u6dfb\u52a0\u591a\u4e2a\u906e\u7f69 Loading\uff0c\u6bcf\u5f53\u4e00\u4e2a\u8bf7\u6c42\u8fd4\u56de\u76f8\u5e94\u540e\u518d\u5173\u95ed\u4e00\u4e2a\u906e\u7f69\uff0c\u8fd9\u5bf9\u7528\u6237\u4f53\u9a8c\u6765\u8bf4\u662f\u4e0d\u53cb\u597d\u7684\uff0c\u5e94\u8be5\u4fdd\u8bc1\u5168\u5c40\u53ea\u6709\u4e00\u4e2a\u906e\u7f69\uff0c\u5728\u6700\u540e\u4e00\u4e2a\u8bf7\u6c42\u5b8c\u6210\u540e\u5173\u95ed\u3002"),Object(a.b)("h2",{id:"\u9700\u6c42\u5b9e\u73b0"},"\u9700\u6c42\u5b9e\u73b0"),Object(a.b)("h3",{id:"\u81ea\u5b9a\u4e49\u7ec4\u4ef6"},"\u81ea\u5b9a\u4e49\u7ec4\u4ef6"),Object(a.b)("h4",{id:"\u7ec4\u4ef6\u8bbe\u8ba1"},"\u7ec4\u4ef6\u8bbe\u8ba1"),Object(a.b)("ol",null,Object(a.b)("li",{parentName:"ol"},"\u906e\u7f69\uff0c\u5c40\u90e8\u906e\u7f69\uff08\u7ec4\u4ef6\uff09\u6216\u5168\u5c4f\u906e\u7f69\uff08\u9ed8\u8ba4\u5168\u5c4f\uff09",Object(a.b)("ul",{parentName:"li"},Object(a.b)("li",{parentName:"ul"},"\u5168\u5c4f\u65f6\uff0c\u906e\u7f69\u5c42\u7edd\u5bf9\u5b9a\u4f4d\u4e8e\u6d4f\u89c8\u5668\u7a97\u53e3\u89c6\u56fe\uff0c position: fixed\uff1b"),Object(a.b)("li",{parentName:"ul"},"\u5c40\u90e8\u65f6\uff0c\u906e\u7f69\u5c42\u7edd\u5bf9\u5b9a\u4f4d\u4e8e\u7ec4\u4ef6\uff0cposition: absolute\uff0cabsolute \u5b9a\u4f4d\u76f8\u5bf9\u4e8e\u6700\u8fd1\u7684\u5df2\u5b9a\u4f4d\u7956\u5148\u5143\u7d20\uff08\u5728\u6211\u4eec\u8fd9\u91cc\u5e94\u8be5\u662f\u76ee\u6807\u6302\u8f7d\u8282\u70b9\uff09\uff0c\u5982\u679c\u6ca1\u6709\u5df2\u5b9a\u4f4d\u7956\u5148\u5143\u7d20\u5219\u4f1a\u9ed8\u8ba4\u4ee5 document.body \u4e3a\u57fa\u51c6\uff0c\u6240\u4ee5\u8bbe\u7f6e\u6839\u5143\u7d20 position: relative\uff0c\u7528 addClass \u548c removeClass \u65b9\u6cd5\u5b9e\u73b0"),Object(a.b)("li",{parentName:"ul"},"\u56fe\u5c42\u4f4d\u4e8e\u6700\u4e0a\u65b9\uff0cz-index \u8bbe\u7f6e 999\uff08\u4f46\u662f\u8fd9\u91cc\u5176\u5b9e\u6ca1\u6709\u5b8c\u5168\u4fdd\u8bc1\u6700\u4e0a\u65b9\uff0c\u4e0d\u4f1a\u5427\uff0c\u4e0d\u4f1a\u5427\uff0c\u4e0d\u4f1a\u6709\u5f39\u51fa\u6846\u6216\u63d0\u793a\u6846 Popover \u7684 z-index \u6bd4\u6211\u8fd8\u5927\u5427\uff1f\uff09"),Object(a.b)("li",{parentName:"ul"},"\u80cc\u666f\u989c\u8272\u53ef\u81ea\u5b9a\u4e49\uff0c\u9ed8\u8ba4 rgba(0, 0, 0, .9)"),Object(a.b)("li",{parentName:"ul"},"\u906e\u7f69\u5185\u5143\u7d20\u5782\u76f4\u3001\u6c34\u5e73\u5c45\u4e2d\uff0c\u7528 flex \u5e03\u5c40\u5b9e\u73b0"))),Object(a.b)("li",{parentName:"ol"},"\u52a8\u6001\u65cb\u8f6c icon \uff0c\u53ef\u81ea\u5b9a\u4e49 element-icon \u5982 \u2018el-icon-loading'\uff0c\u9ed8\u8ba4\u4f7f\u7528 CSS \u52a8\u753b\u5b9e\u73b0\u7684\u5706\u73af\u65cb\u8f6c"),Object(a.b)("li",{parentName:"ol"},"\u6587\u5b57\u63d0\u793a\uff0c\u53ef\u81ea\u5b9a\u4e49\uff0c\u9ed8\u8ba4\u4e3a\u7a7a"),Object(a.b)("li",{parentName:"ol"},"\u4f18\u5316\u4ea4\u4e92\u6548\u679c\uff0c\u7ed9\u7ec4\u4ef6\u6dfb\u52a0\u6de1\u5165\u3001\u6de1\u51fa\u7684\u8fc7\u6e21\u6548\u679c\u3002")),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-javascript"},'<template>\n    <transition name="fade">\n        <div\n            v-show="visible"\n            class="loading-mask"\n            :style="{ background: background || \'\' }"\n            :class="{ \'is-fullscreen\': fullscreen }">\n            <div class="loading-spinner">\n                <i v-if="icon" :class="icon" />\n                <div v-else class="loading-icon"></div>\n                <p v-if="text" class="loading-text">\n                    {{ text }}\n                </p>\n            </div>\n        </div>\n    </transition>\n</template>\n')),Object(a.b)("p",null,"\u6837\u5f0f\u4ee3\u7801\uff1a"),Object(a.b)("details",null,Object(a.b)("summary",null,"Click to expand code"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-scss"},"$PRIMARY_COLOR: #409eff;\n\n.loading-mask {\n    position: absolute;\n    margin: 0;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    z-index: 999;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    background:rgba(0, 0, 0, .6);\n}\n\n.is-fullscreen {\n    position: fixed;\n}\n\n.loading-spinner {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    color: $PRIMARY_COLOR;\n}\n\n.loading-icon {\n    width: 2em;\n    height: 2em;\n    border-radius: 100%;\n    border-width: .1em;\n    border-style: solid;\n    border-color: transparent;\n    animation: spin 1.5s linear infinite;\n}\n\n.loading-text {\n    font-size: 1em;\n}\n\n@keyframes spin {\n    0% {\n        border-color: $PRIMARY_COLOR transparent transparent transparent;\n        transform: rotate(0);\n    }\n    25% {\n        transform: rotate(90deg);\n    }\n    50% {\n        transform: rotate(180deg);\n    }\n    75% {\n        transform: rotate(270deg);\n    }\n    100% {\n        border-color: transparent $PRIMARY_COLOR $PRIMARY_COLOR $PRIMARY_COLOR;\n        transform: rotate(360deg)\n    }\n}\n\n.fade-enter-active, .fade-leave-active {\n  transition: opacity .5s;\n}\n.fade-enter, .fade-leave-to /* .fade-leave-active below version 2.1.8 */ {\n  opacity: 0;\n}\n"))),Object(a.b)("h4",{id:"\u66b4\u9732\u670d\u52a1\u63a5\u53e3"},"\u66b4\u9732\u670d\u52a1\u63a5\u53e3"),Object(a.b)("details",null,Object(a.b)("summary",null,"Click to expand code"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-js"},"import Vue from 'vue'\nimport loading from './loading.vue'\nimport { afterLeave, addClass, removeClass, getStyle } from './utils'\n\nconst LoadingConstructor = Vue.extend(loading)\n\ninterface LoadingConfig {\n    target?: any,  // \u906e\u7f69\u7684\u76ee\u6807\u8282\u70b9\uff0c\u9ed8\u8ba4\u662f document.body\n    fullscreen?: boolean,  // \u662f\u5426\u5168\u5c4f\uff0c\u9ed8\u8ba4\u4e3a true\n    background?: string,   // \u906e\u7f69\u5c42\u7684\u80cc\u666f\u989c\u8272\n    icon?: string,    // \u65cb\u8f6cicon\uff0c\u9ed8\u8ba4\u4e3a\u65cb\u8f6c\u7684\u5706\u73af\n    text?: string,    // \u63d0\u793a\u6587\u5b57\uff0c\u9ed8\u8ba4\u4e3a\u7a7a\n}\n\nconst DEFAULTCONFIG = {\n    fullscreen: true,\n}\n\n// \u5168\u5c4f\u6a21\u5f0f\u4e0b\uff0c\u5355\u4f8b\uff0c\u4e0d\u91cd\u590d\u521b\u5efa\nlet fullscreenLoading: any\n\nLoadingConstructor.prototype.originalPosition = ''\n\n// \u5173\u95ed Loading, \u9500\u6bc1\u7ec4\u4ef6\nLoadingConstructor.prototype.close = function() {\n    if (this.fullscreen) {\n        fullscreenLoading = undefined\n    }\n    afterLeave(this, () => {\n        const target = this.fullscreen ? document.body : this.target\n        removeClass(target, 'loading-parent-relative')\n        if (this.$el && this.$el.parentNode) {\n            this.$el.parentNode.removeChild(this.$el)\n        }\n        this.$destroy()\n    }, 500)\n    this.visible = false\n}\n\nconst addStyle = (options: LoadingConfig, parent: any, instance: any) => {\n    let maskStyle: any = {}\n    if (options.fullscreen) {\n        instance.originalPosition = getStyle(document.body, 'position')\n        maskStyle.zIndex = 999\n    } else {\n        instance.originalPosition = getStyle(parent, 'position')\n    }\n    Object.keys(maskStyle).forEach(property => {\n        instance.$el.style[property] = maskStyle[property]\n    })\n}\n\nconst Loading = (options: LoadingConfig) => {\n    options = { ...DEFAULTCONFIG, ...options}\n    if (typeof options.target === 'string' && options.target.length) {\n        try {\n            options.target = document.querySelector(options.target)\n        } catch (e) {\n            throw 'invalid target'\n        }\n    }\n\n    options.target = options.target || document.body\n    // \u5982\u679c\u76ee\u6807\u8282\u70b9\u4e0d\u662f document.body \u8bf4\u660e\u4e0d\u662f\u5168\u5c4f\u6a21\u5f0f\n    if (options.target !== document.body) {\n        options.fullscreen = false\n    }\n    // \u5168\u5c4f\u6a21\u5f0f\u4e0b\uff0c\u5355\u4f8b\uff0c\u4e0d\u91cd\u590d\u521b\u5efa\n    if (options.fullscreen && fullscreenLoading) {\n        return fullscreenLoading\n    }\n    let parent = options.target\n    // \u521b\u5efa\u7ec4\u4ef6\u5b9e\u4f8b\uff0c\u4f20\u5165\u5904\u7406\u540e\u7684\u53c2\u6570\n    let instance: any = new LoadingConstructor({\n        el: document.createElement('div'),\n        data: options\n    })\n    addStyle(options, parent, instance)\n    console.log(options.fullscreen, options.target, instance.originalPosition)\n    if (instance.originalPosition !== 'absolute' && instance.originalPosition !== 'fixed') {\n        addClass(parent, 'loading-parent-relative')\n    }\n    parent.appendChild(instance.$el)\n    // \u6e32\u67d3\u7ec4\u4ef6\n    Vue.nextTick(() => {\n        instance.visible = true\n    })\n    if (options.fullscreen) {\n        fullscreenLoading = instance\n    }\n    return instance\n}\n\nexport default Loading\n"))),Object(a.b)("h4",{id:"\u6ce8\u518c\u81ea\u5b9a\u4e49\u6307\u4ee4"},"\u6ce8\u518c\u81ea\u5b9a\u4e49\u6307\u4ee4"),Object(a.b)("p",null,"\u4e00\u4e2a\u6307\u4ee4\u5b9a\u4e49\u5bf9\u8c61\u53ef\u4ee5\u63d0\u4f9b\u5982\u4e0b\u51e0\u4e2a\u94a9\u5b50\u51fd\u6570 \uff08\u5747\u4e3a\u53ef\u9009\uff09\uff1a"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"bind\uff1a\u7ed1\u5b9a\u89e6\u53d1\uff0c\u53ea\u8c03\u7528\u4e00\u6b21\uff0c\u6307\u4ee4\u7b2c\u4e00\u6b21\u7ed1\u5b9a\u5230\u5143\u7d20\u65f6\u8c03\u7528\u3002\u5728\u8fd9\u91cc\u53ef\u4ee5\u8fdb\u884c\u4e00\u6b21\u6027\u7684\u521d\u59cb\u5316\u8bbe\u7f6e\u3002"),Object(a.b)("li",{parentName:"ul"},"inserted\uff1a\u63d2\u5165\u89e6\u53d1\uff0c\u88ab\u7ed1\u5b9a\u5143\u7d20\u63d2\u5165\u7236\u8282\u70b9\u65f6\u8c03\u7528 \uff08\u4ec5\u4fdd\u8bc1\u7236\u8282\u70b9\u5b58\u5728\uff0c\u4f46\u4e0d\u4e00\u5b9a\u5df2\u88ab\u63d2\u5165\u6587\u6863\u4e2d\uff09\u3002"),Object(a.b)("li",{parentName:"ul"},"update\uff1a\u66f4\u65b0\u89e6\u53d1\uff0c\u6240\u5728\u7ec4\u4ef6\u7684 VNode \u66f4\u65b0\u65f6\u8c03\u7528\uff0c\u4f46\u662f\u53ef\u80fd\u53d1\u751f\u5728\u5176\u5b50 VNode \u66f4\u65b0\u4e4b\u524d\u3002\u6307\u4ee4\u7684\u503c\u53ef\u80fd\u53d1\u751f\u4e86\u6539\u53d8\uff0c\u4e5f\u53ef\u80fd\u6ca1\u6709\u3002\u4f46\u662f\u53ef\u4ee5\u901a\u8fc7\u6bd4\u8f83\u66f4\u65b0\u524d\u540e\u7684\u503c\u6765\u5ffd\u7565\u4e0d\u5fc5\u8981\u7684\u6a21\u677f\u66f4\u65b0\u3002"),Object(a.b)("li",{parentName:"ul"},"componentUpdated\uff1a\u7ec4\u4ef6\u66f4\u65b0\u89e6\u53d1\uff0c\u6307\u4ee4\u6240\u5728\u7ec4\u4ef6\u7684 VNode\xa0\u53ca\u5176\u5b50 VNode\xa0\u5168\u90e8\u66f4\u65b0\u540e\u8c03\u7528\u3002"),Object(a.b)("li",{parentName:"ul"},"unbind\uff1a\u89e3\u7ed1\u89e6\u53d1\uff0c\u53ea\u8c03\u7528\u4e00\u6b21\uff0c\u6307\u4ee4\u4e0e\u5143\u7d20\u89e3\u7ed1\u65f6\u8c03\u7528\u3002")),Object(a.b)("p",null,"\u6307\u4ee4\u94a9\u5b50\u51fd\u6570\u4f1a\u88ab\u4f20\u5165\u4ee5\u4e0b\u53c2\u6570\uff1a"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"el\uff1a\u6307\u4ee4\u6240\u7ed1\u5b9a\u7684\u5143\u7d20\uff0c\u53ef\u4ee5\u7528\u6765\u76f4\u63a5\u64cd\u4f5c DOM\u3002"),Object(a.b)("li",{parentName:"ul"},"binding\uff1a\u4e00\u4e2a\u5bf9\u8c61\uff0c\u5305\u542b\u4ee5\u4e0b property\uff1a",Object(a.b)("ul",{parentName:"li"},Object(a.b)("li",{parentName:"ul"},"name\uff1a\u6307\u4ee4\u540d\uff0c\u4e0d\u5305\u62ec v- \u524d\u7f00\u3002"),Object(a.b)("li",{parentName:"ul"},'value\uff1a\u6307\u4ee4\u7684\u7ed1\u5b9a\u503c\uff0c\u4f8b\u5982\uff1av-my-directive="1 + 1" \u4e2d\uff0c\u7ed1\u5b9a\u503c\u4e3a 2\u3002'),Object(a.b)("li",{parentName:"ul"},"oldValue\uff1a\u6307\u4ee4\u7ed1\u5b9a\u7684\u524d\u4e00\u4e2a\u503c\uff0c\u4ec5\u5728 update \u548c componentUpdated \u94a9\u5b50\u4e2d\u53ef\u7528\u3002\u65e0\u8bba\u503c\u662f\u5426\u6539\u53d8\u90fd\u53ef\u7528\u3002"),Object(a.b)("li",{parentName:"ul"},'expression\uff1a\u5b57\u7b26\u4e32\u5f62\u5f0f\u7684\u6307\u4ee4\u8868\u8fbe\u5f0f\u3002\u4f8b\u5982 v-my-directive="1 + 1" \u4e2d\uff0c\u8868\u8fbe\u5f0f\u4e3a "1 + 1"\u3002'),Object(a.b)("li",{parentName:"ul"},'arg\uff1a\u4f20\u7ed9\u6307\u4ee4\u7684\u53c2\u6570\uff0c\u53ef\u9009\u3002\u4f8b\u5982 v-my-directive:foo \u4e2d\uff0c\u53c2\u6570\u4e3a "foo"\u3002'),Object(a.b)("li",{parentName:"ul"},"modifiers\uff1a\u4e00\u4e2a\u5305\u542b\u4fee\u9970\u7b26\u7684\u5bf9\u8c61\u3002\u4f8b\u5982\uff1av-my-directive.foo.bar \u4e2d\uff0c\u4fee\u9970\u7b26\u5bf9\u8c61\u4e3a { foo: true, bar: true }\u3002"))),Object(a.b)("li",{parentName:"ul"},"vnode\uff1aVue \u7f16\u8bd1\u751f\u6210\u7684\u865a\u62df\u8282\u70b9\u3002\u79fb\u6b65 VNode API \u6765\u4e86\u89e3\u66f4\u591a\u8be6\u60c5\u3002"),Object(a.b)("li",{parentName:"ul"},"oldVnode\uff1a\u4e0a\u4e00\u4e2a\u865a\u62df\u8282\u70b9\uff0c\u4ec5\u5728 update \u548c componentUpdated \u94a9\u5b50\u4e2d\u53ef\u7528\u3002")),Object(a.b)("blockquote",null,Object(a.b)("p",{parentName:"blockquote"},"\u9664\u4e86 el \u4e4b\u5916\uff0c\u5176\u5b83\u53c2\u6570\u90fd\u5e94\u8be5\u662f\u53ea\u8bfb\u7684\uff0c\u5207\u52ff\u8fdb\u884c\u4fee\u6539\u3002\u5982\u679c\u9700\u8981\u5728\u94a9\u5b50\u4e4b\u95f4\u5171\u4eab\u6570\u636e\uff0c\u5efa\u8bae\u901a\u8fc7\u5143\u7d20\u7684 dataset \u6765\u8fdb\u884c\u3002")),Object(a.b)("details",null,Object(a.b)("summary",null,"Click to expand code"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-js"},"import Vue from 'vue'\nimport Loading from './loading.vue'\nimport { afterLeave, addClass, removeClass, getStyle } from './utils'\n\nconst LoadingConstructor = Vue.extend(Loading)\nconst loadingDirective: any = {}\n\ninterface bindingConfig {\n    name?: string,\n    value?: any,\n    oldValue?: any,\n    arg?: string,\n    expression?: string,\n    modifiers: any,\n}\n\nloadingDirective.install = (Vue: any) => {\n    // \u5207\u6362\u7ec4\u4ef6\u7684\u663e\u793a\u72b6\u6001\n    const toggleLoading = (el: any, binding: bindingConfig) => {\n        if (binding.value) {\n            Vue.nextTick(() => {\n                if (binding.modifiers.fullscreen || binding.modifiers.body) {\n                    el.originalPosition = getStyle(document.body, 'position')\n                    el.maskStyle.zIndex = 999  // \u4e0d\u4e00\u5b9a\u80fd\u786e\u4fdd\u906e\u7f69\u5c42\u5728\u6700\u4e0a\u9762\n                    addClass(el.mask, 'is-fullscreen')\n                    insertDom(document.body, el)\n                } else {\n                    el.originalPosition = getStyle(el, 'position')\n                    removeClass(el.mask, 'is-fullscreen')\n                    insertDom(el, el)\n                }\n            })\n        } else {\n            afterLeave(el.instance, () => {\n                if (!el.instance.hiding) return\n                el.domVisible = false\n                const target = binding.modifiers.fullscreen || binding.modifiers.body ? document.body : el\n                removeClass(target, 'loading-parent-relative')\n                el.instance.hiding = false\n            }, 300, true)\n            el.instance.visible = false\n            el.instance.hiding = true\n        }\n    }\n\n    // \u63d2\u5165DOM\n    const insertDom = (parent: any, el: any) => {\n        if (!el.domVisible && getStyle(el, 'display') !== 'none' && getStyle(el, 'visibility') !== 'hidden') {\n            Object.keys(el.maskStyle).forEach(property => {\n                el.mask.style[property] = el.maskStyle[property]\n            })\n\n            if (el.originalPosition !== 'absolute' && el.originalPosition !== 'fixed') {\n                addClass(parent, 'loading-parent-relative')\n            }\n            el.domVisible = true\n\n            parent.appendChild(el.mask)\n            Vue.nextTick(() => {\n                if (el.instance.hiding) {\n                    el.instance.$emit('after-leave')\n                } else {\n                    el.instance.visible = true\n                }\n            })\n            el.domInserted = true\n        } else if (el.domVisible && el.instance.hiding === true) {\n            el.instance.visible = true\n            el.instance.hiding = false\n        }\n    }\n\n    Vue.directive('customLoading', {\n        bind(el: any, binding: bindingConfig, vnode: any) {\n            const textExr = el.getAttribute('loading-text')\n            const spinnerExr = el.getAttribute('loading-spinner')\n            const backgroundExr = el.getAttribute('loading-background')\n            const vm = vnode.context\n            // \u4f20\u53c2\u6784\u5efa\u5b9e\u4f8b\n            const instance = new LoadingConstructor({\n                el: document.createElement('div'),\n                data: {\n                    text: vm && vm[textExr] || textExr,\n                    spinner: vm && vm[spinnerExr] || spinnerExr,\n                    background: vm && vm[backgroundExr] || backgroundExr,\n                    fullscreen: !!binding.modifiers.fullscreen\n                }\n            })\n            el.instance = instance\n            el.mask = instance.$el\n            el.maskStyle = {}\n\n            binding.value && toggleLoading(el, binding)\n        },\n\n        update(el: any, binding: bindingConfig) {\n            el.instance.setText(el.getAttribute('element-loading-text'))\n            if (binding.oldValue !== binding.value) {\n                toggleLoading(el, binding)\n            }\n        },\n\n        unbind(el: any, binding: bindingConfig) {\n            if (el.domInserted) {\n                el.mask &&\n                el.mask.parentNode &&\n                el.mask.parentNode.removeChild(el.mask)\n                toggleLoading(el, { value: false, modifiers: binding.modifiers })\n            }\n            el.instance && el.instance.$destroy()\n        }\n    })\n}\n\nexport default loadingDirective\n"))),Object(a.b)("h3",{id:"\u5355\u4f8b\u6a21\u5f0f"},"\u5355\u4f8b\u6a21\u5f0f"),Object(a.b)("p",null,"\u4e3a\u4ec0\u4e48\u4e0d\u76f4\u63a5\u8c03\u7528 element-ui \u7684 Loading \u7ec4\u4ef6\u5462\uff1f"),Object(a.b)("blockquote",null,Object(a.b)("p",{parentName:"blockquote"},"\u4ee5\u670d\u52a1\u7684\u65b9\u5f0f\u8c03\u7528\u7684\u5168\u5c4f Loading \u662f\u5355\u4f8b\u7684\uff1a\u82e5\u5728\u524d\u4e00\u4e2a\u5168\u5c4f Loading \u5173\u95ed\u524d\u518d\u6b21\u8c03\u7528\u5168\u5c4f Loading\uff0c\u5e76\u4e0d\u4f1a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 Loading \u5b9e\u4f8b\uff0c\u800c\u662f\u8fd4\u56de\u73b0\u6709\u5168\u5c4f Loading \u7684\u5b9e\u4f8b\u3002"),Object(a.b)("p",{parentName:"blockquote"},"\u6b64\u65f6\u8c03\u7528\u5b83\u4eec\u4e2d\u4efb\u610f\u4e00\u4e2a\u7684\xa0close\xa0\u65b9\u6cd5\u90fd\u80fd\u5173\u95ed\u8fd9\u4e2a\u5168\u5c4f Loading\uff0c\u8fd9\u5e76\u4e0d\u7b26\u5408\u6211\u4eec\u9884\u671f\u5bf9\u5e76\u884c\u8bf7\u6c42\u7684\u5904\u7406\u3002")),Object(a.b)("p",null,"\u5728\u73b0\u6709\u7684\u5f88\u591a\u793a\u4f8b\u91cc\uff0c\u7528 state \u5b58\u50a8 Loading \u7ec4\u4ef6\u7684 visible \u72b6\u6001\uff0c \u4f46\u662f\u6211\u4eec\u7684\u591a\u9875\u9762\u5e94\u7528\uff0c\u6709\u591a\u4e2a\u72ec\u7acb\u7684 Store\uff0c\u5e76\u4e0d\u9002\u5408\u3002"),Object(a.b)("p",null,"\u4e3a\u4e86\u517c\u5bb9 Loading \u7ec4\u4ef6\u9002\u7528\u4e8e\u5176\u4ed6\u60c5\u51b5\uff0c\u53e6\u5916\u5305\u88c5\u4e00\u5c42\uff0c\u4fdd\u8bc1\u53ea\u6709\u4e00\u4e2a Loading \u5b9e\u4f8b\u3002"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-js"},"import Loading from '../../components/loading'\n\nconst LOADING_CONFIG = {\n    fullscreen: true,\n    text: \"\u8bf7\u6c42\u4e2d\"\n}\n\nexport default class SingletonLoading {\n    private static loadingInstance: any\n    private static loadingNum: number\n    // \u79c1\u6709\u6784\u9020\u51fd\u6570\n    private constructor () {}\n    private static noneLoadingReqeusts (): boolean {\n        return SingletonLoading.loadingNum === 0\n    }\n    // \u516c\u6709\u9759\u6001\u51fd\u6570\uff0c\u53ea\u6709\u7c7b\u80fd\u8c03\u7528\n    public static show (): any {\n        if (!SingletonLoading.loadingInstance) {\n            SingletonLoading.loadingInstance = Loading.service(LOADING_CONFIG)\n            SingletonLoading.loadingNum = 0\n        }\n        SingletonLoading.loadingNum += 1\n    }\n    public static close (): any {\n        SingletonLoading.loadingNum -= 1\n        // \u5f53\u6ca1\u6709\u6b63\u5728\u8fdb\u884c\u4e2d\u7684\u8bf7\u6c42\uff0c\u9500\u6bc1\u7ec4\u4ef6\n        if (SingletonLoading.noneLoadingReqeusts()) {\n            SingletonLoading.loadingInstance.close()\n            SingletonLoading.loadingInstance = null\n        }\n    }\n}\n")),Object(a.b)("h3",{id:"axios-\u89e3\u6790"},"Axios \u89e3\u6790"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-js"},"instance.interceptors.request.use(\n    (config: any) => {\n        if (config.showLoader) {\n            SingletonLoading.show()\n        }\n        // do something before request is sent\n        return config\n    },\n    error => {\n        return Promise.reject(error)\n    },\n)\n\ninstance.interceptors.response.use(\n    response => {\n        const { data, config }: { data: any, config: any} = response\n        if (config.showLoader) {\n            SingletonLoading.close()\n        }\n        // do something with response data\n    },\n    error => {\n        return Promise.reject(error)\n    },\n)\n")),Object(a.b)("h2",{id:"\u6700\u7ec8\u6548\u679c"},"\u6700\u7ec8\u6548\u679c"),Object(a.b)("p",null,Object(a.b)("img",{alt:"loading",src:t(215).default})))}d.isMDXComponent=!0}}]);